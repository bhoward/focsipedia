<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.7">
<link rel="alternate" type="application/rss+xml" href="/focsipedia/blog/rss.xml" title="FoCSipedia RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/focsipedia/blog/atom.xml" title="FoCSipedia Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="FoCSipedia" href="/focsipedia/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.min.css">
<script src="/focsipedia/toplevel.js"></script>
<script src="/focsipedia/resetLocalPrelude.js"></script><title data-react-helmet="true">State Machines in Java and ReasonML | FoCSipedia</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://bhoward.github.io//focsipedia/docs/fp/state"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="State Machines in Java and ReasonML | FoCSipedia"><meta data-react-helmet="true" name="description" content="There are many ways to implement the state machine concept in code. The essence is that"><meta data-react-helmet="true" property="og:description" content="There are many ways to implement the state machine concept in code. The essence is that"><link data-react-helmet="true" rel="shortcut icon" href="/focsipedia/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://bhoward.github.io//focsipedia/docs/fp/state"><link data-react-helmet="true" rel="alternate" href="https://bhoward.github.io//focsipedia/docs/fp/state" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://bhoward.github.io//focsipedia/docs/fp/state" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://YNUYSORFOS-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/focsipedia/assets/css/styles.b12f2fa0.css">
<link rel="preload" href="/focsipedia/assets/js/runtime~main.c33171f0.js" as="script">
<link rel="preload" href="/focsipedia/assets/js/main.d0c66c92.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/focsipedia/"><div class="navbar__logo"><img src="/focsipedia/img/SmartFoxIcon.jpeg" alt="Smart Fox Logo" class="themedImage_1VuW themedImage--light_3UqQ"><img src="/focsipedia/img/SmartFoxIcon.jpeg" alt="Smart Fox Logo" class="themedImage_1VuW themedImage--dark_hz6m"></div><b class="navbar__title">FoCSipedia</b></a><a class="navbar__item navbar__link" href="/focsipedia/docs/topics">Topics</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/bhoward/focsipedia" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Course Info</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Logic</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Sets</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Functional Programming</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/focsipedia/docs/fp/overview">Overview of Functional Programming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/focsipedia/docs/fp/intro">Introduction to Functional Programming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/focsipedia/docs/fp/types">Types in Functional Programming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/focsipedia/docs/fp/map-reduce">Map and Reduce on Lists</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/focsipedia/docs/fp/doodle">DPoodle Graphics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/focsipedia/docs/fp/state">State Machines in Java and ReasonML</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/focsipedia/docs/fp/parser-comb">Recursive Descent and Parser Combinators</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/focsipedia/docs/fp/lambda">Lambda Calculus</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Lists, Trees, and Graphs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Formal Languages</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Features</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD theme-doc-toc-mobile tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>State Machines in Java and ReasonML</h1></header><p>There are many ways to implement the state machine concept in code. The essence is that
the input is processed one item at a time, in order, with only a fixed amount of
information (the &quot;state&quot;) preserved from one item to the next. The iteration over the
items may be performed by a loop or recursion; the state may be maintained explicitly
in variables or hidden in an object, or it may be implicit in the current section of
code being executed; the transition from one state to the next may be controlled by a
series of conditional statements, a data structure representing the transition graph,
or a function which encapsulates the required logic. Here are some examples:</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="strings-containing-aeiou">Strings containing &quot;aeiou&quot;<a aria-hidden="true" class="hash-link" href="#strings-containing-aeiou" title="Direct link to heading">â€‹</a></h2><p>This is an example from Section 10.2 of <a href="http://infolab.stanford.edu/~ullman/focs.html" target="_blank" rel="noopener noreferrer">Aho <!-- -->&amp;<!-- --> Ullman</a>.
A string of lower-case letters will be accepted if it contains the vowels <em>a</em>, <em>e</em>, <em>i</em>, <em>o</em>, and <em>u</em>, in that order
(the vowels may occur in other positions as well, as in &quot;sacrilegious&quot;).</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="state-implicit-in-conditional-statements">State implicit in conditional statements<a aria-hidden="true" class="hash-link" href="#state-implicit-in-conditional-statements" title="Direct link to heading">â€‹</a></h3><p>Here to start is a Java version of Aho <!-- -->&amp;<!-- --> Ullman&#x27;s Figure 10.2 (the original was in C):</p><div class="codeBlockWrapper_cAds"><pre class="prism-code language-java codeBlock_6upA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class ContainsAEIOU {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private String word;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private int index;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private boolean findChar(char c) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    while (index &lt; word.length() &amp;&amp; word.charAt(index) != c) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      index++;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (index &lt; word.length()) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      // character c found at position index; prepare for next call</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      index++;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return true;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      // character not found in rest of word</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return false;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public boolean test(String word) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    this.word = word;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    this.index = 0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /* state 0 */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (findChar(&#x27;a&#x27;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      /* state 1 */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (findChar(&#x27;e&#x27;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        /* state 2 */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (findChar(&#x27;i&#x27;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          /* state 3 */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          if (findChar(&#x27;o&#x27;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            /* state 4 */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if (findChar(&#x27;u&#x27;))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              /* state 5 */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              return true;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /* error state */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return false;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public static void main(String[] args) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    ContainsAEIOU c = new ContainsAEIOU();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    System.out.println(c.test(&quot;abstemious&quot;)); // should be true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    System.out.println(c.test(&quot;sacrilegious&quot;)); // should be true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    System.out.println(c.test(&quot;undercoating&quot;)); // should be false -- not in order</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    System.out.println(c.test(&quot;religious&quot;)); // should be false -- no a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    System.out.println(c.test(&quot;aeiou&quot;)); // should be true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i">Copy</button></div><p>The input is processed in this version by the <code>while</code> loop in the <code>findChar</code>
method; the variable <code>index</code> (which is a class instance variable so that its value
will persist between calls to <code>findChar</code>) is used to step through the characters in the word.
The current &quot;state&quot; is reflected in how far the execution has progressed through
the nested <code>if</code> statements in <code>test</code>; after reading characters for a while in
state 0, it transitions to state 1 when the first <em>a</em> is seen, then to state 2 upon
seeing a following <em>e</em>, <em>etc</em>. If any of the calls to <code>findChar</code> return false, meaning
the end of the string has been reached while looking for one of the vowels, then the
machine enters an error state (<em>i.e.</em>, it falls through to the <code>return false</code> at the end).
If all of the calls to <code>findChar</code> succeed, then the
machine reaches state 5 and immediately returns true (without looking at the rest
of the string).</p><p>Given the way the <code>&amp;&amp;</code> operator is evaluated from left to right, the sequence of <code>if</code> and
<code>return</code> statements in the <code>test</code> method could also be written</p><div class="codeBlockWrapper_cAds"><pre class="prism-code language-java codeBlock_6upA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">return findChar(&#x27;a&#x27;) &amp;&amp; findChar(&#x27;e&#x27;) &amp;&amp; findChar(&#x27;i&#x27;) &amp;&amp; findChar(&#x27;o&#x27;) &amp;&amp; findChar(&#x27;u&#x27;);</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i">Copy</button></div><p>This is completely equivalent (and likely even generates the same compiled code), although
it might be harder to see which point in the code corresponds to each state.</p><p>The Java version is a very imperative approach to the problem, depending as it does on changes
to the variable <code>index</code> as it traces through the sequence of method calls and loops. Here is a
more functional equivalent in ReasonML, where indexing into a string is replaced by traversing
through a list of characters, and the <code>findChar</code> method returns a pair of a boolean plus the
list of the remaining unsearched characters:</p><div><div><button type="button" aria-label="Execute code">Execute</button></div></div><div class="playgroundPreview_29OS"><div></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="integer-state-with-transitions-in-a-graph">Integer state with transitions in a graph<a aria-hidden="true" class="hash-link" href="#integer-state-with-transitions-in-a-graph" title="Direct link to heading">â€‹</a></h3><p>Here is the same state machine, with the state explicitly represented by an integer
in the range 0 to 5. The transitions are stored in an array of functions: <code>trans[i]</code> is the
function, for state <code>i</code>, from the current character to the next state.
Note that this is similar to the adjacency matrix representation of a graph, except here
we are looking up a node (<code>i</code>) and an input symbol (<code>c</code>) to select an adjacent node, instead
of looking up two nodes to see whether they are adjacent.
Each of the functions in
this case is particularly simple, since at most one edge leads away from each state
to another. See below for other examples using more complicated graphs.</p><div><div><button type="button" aria-label="Execute code">Execute</button></div></div><div class="playgroundPreview_29OS"><div></div></div><p>Walking over a list and applying a transition function from the current state and input
item to get the next state is just a direct application of our <code>reduce</code> function on
lists; the ReasonML library calls it <code>List.fold_left</code>.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="object-oriented-state-and-transitions">Object-oriented state and transitions<a aria-hidden="true" class="hash-link" href="#object-oriented-state-and-transitions" title="Direct link to heading">â€‹</a></h3><p>Instead of assigning arbitrary numbers to the states, and collecting all of the
transition information into a global graph data structure, a more object-oriented
approach associates an object with each state. Here is a Java implementation of this idea:</p><div class="codeBlockWrapper_cAds"><pre class="prism-code language-java codeBlock_6upA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">package edu.depauw.csc233;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class ContainsAEIOU2 {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private interface State {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    State trans(char c);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    default boolean accept() { return false; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private static class InitialState implements State {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public State trans(char c) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (c == &#x27;a&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return new AState();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return this;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private static class AState implements State {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public State trans(char c) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (c == &#x27;e&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return new AEState();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return this;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private static class AEState implements State {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public State trans(char c) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (c == &#x27;i&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return new AEIState();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return this;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private static class AEIState implements State {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public State trans(char c) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (c == &#x27;o&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return new AEIOState();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return this;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private static class AEIOState implements State {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public State trans(char c) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (c == &#x27;u&#x27;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return new AEIOUState();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return this;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private static class AEIOUState implements State {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public State trans(char c) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return this;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public boolean accept() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return true;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public static boolean test(String word) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    State state = new InitialState();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    for (int i = 0; i &lt; word.length(); i++) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      state = state.trans(word.charAt(i));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return state.accept();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public static void main(String[] args) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    System.out.println(test(&quot;abstemious&quot;)); // should be true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    System.out.println(test(&quot;sacrilegious&quot;)); // should be true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    System.out.println(test(&quot;undercoating&quot;)); // should be false -- not in order</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    System.out.println(test(&quot;religious&quot;)); // should be false -- no a</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    System.out.println(test(&quot;aeiou&quot;)); // should be true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i">Copy</button></div><p>Each of the state classes implements the <code>State</code> interface, which bundles both a
transition method, <code>trans</code> (it computes the next state for a given input character),
and an <code>accept</code> method (it returns true if the state is accepting; the interface
provides a default implementation that returns false). The <code>test</code> function now only
needs to know the initial state; it would be written in exactly the same way for
any machine that processes the characters in a string.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="functional-state-and-transitions">Functional state and transitions<a aria-hidden="true" class="hash-link" href="#functional-state-and-transitions" title="Direct link to heading">â€‹</a></h3><p>An interesting functional equivalent to the previous object-oriented version
represents each state by a pair of a boolean and a function from characters to states.
Since the <code>state</code> type is defined in terms of itself, we need to wrap it up in a
constructor:</p><div></div><div class="playgroundPreview_29OS"><div></div></div><p>Here is the code for our &quot;aeiou&quot; machine:</p><div><div><button type="button" aria-label="Execute code">Execute</button></div></div><div class="playgroundPreview_29OS"><div></div></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="vending-machine">Vending Machine<a aria-hidden="true" class="hash-link" href="#vending-machine" title="Direct link to heading">â€‹</a></h2><p>Suppose we want to model a vending machine which accepts nickels, dimes, and quarters,
and dispenses a piece of candy when 25 cents has been deposited. If more than 25 cents
is put in (for example, three dimes), then after dispensing the candy the remaining
amount is applied toward the next transaction (that is, it doesn&#x27;t give any change).</p><p>This use of a finite state machine is a bit different from what we have seen before, since
there is no notion of an &quot;accepting&quot; state. Instead, we imagine that the machine is
performing a long-running computation (in this case, it runs as long as the vending
machine is in service, potentially for years).
It is customary for this kind of machine to add a notion of &quot;output,&quot; so that the
machine can give feedback after each transition instead of just at the end (which may
never come). There are two standard models for doing this:</p><ul><li><p>A <strong>Mealy Machine</strong> is a finite state machine where each transition has an associated
output. We annotate each transition with a label such as <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi mathvariant="normal">/</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">a/x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault">a</span><span class="mord">/</span><span class="mord mathdefault">x</span></span></span></span></span>, meaning that it takes the
transition if the input is <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathdefault">a</span></span></span></span></span>, and as it does so it produces output <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathdefault">x</span></span></span></span></span>.</p></li><li><p>A <strong>Moore Machine</strong> is a finite state machine where the output after each transition is
determined by the new state. Each state has a label such as <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi><mi mathvariant="normal">/</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">A/x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em"></span><span class="mord mathdefault">A</span><span class="mord">/</span><span class="mord mathdefault">x</span></span></span></span></span>, meaning that when the
machine transitions to state <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em"></span><span class="mord mathdefault">A</span></span></span></span></span> it will also produce output <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathdefault">x</span></span></span></span></span>.</p></li></ul><p>For both kinds of machines, the output may be <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Îµ</mi></mrow><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em"></span><span class="mord mathdefault">Îµ</span></span></span></span></span> if no output is desired at that time.
It is not very difficult to see that Mealy and Moore machines have equivalent power, by showing
how to construct each from the other; the choice is often a matter of convenience. For example,
in constructing a sequential circuit implementation, the Moore machine has the advantage that
the output part of the circuit only needs lines connecting to the current state (the outputs
of the flip-flops), while the Mealy machine may require fewer states (and hence fewer flip-flops)
in some cases.</p><h3 class="anchor anchorWithStickyNavbar_31ik" id="integer-state-with-transitions-in-a-graph-1">Integer state with transitions in a graph<a aria-hidden="true" class="hash-link" href="#integer-state-with-transitions-in-a-graph-1" title="Direct link to heading">â€‹</a></h3><p>We will adopt a similar solution as for the second version of the vowel problem. This
time, the integer state numbers will be more meaningful: they will be 0, 5, 10, 15,
and 20, representing the amount of money which has been deposited so far. Since these
are not consecutive, the graph will be represented by a function with two inputs instead of an
array of functions. Also, there will be no need for default transitions, since each of the
three possible inputs (&#x27;N&#x27;, &#x27;D&#x27;, or &#x27;Q&#x27;, for nickel, dime, and quarter) will cause a
different change of state. One further difference is that each edge in the graph will
give not only a new state but also an indication of whether candy was given out on
the transition (this means that it is a Mealy machine). Finally, there is no accepting state, since the machine will keep
running as long as there is input; in the example below, we will print &quot;Candy!&quot;
whenever it produces a piece of candy.</p><div><div><button type="button" aria-label="Execute code">Execute</button></div></div><div class="playgroundPreview_29OS"><div></div></div><h3 class="anchor anchorWithStickyNavbar_31ik" id="object-oriented-approach-with-encapsulated-state">Object-oriented approach with encapsulated state<a aria-hidden="true" class="hash-link" href="#object-oriented-approach-with-encapsulated-state" title="Direct link to heading">â€‹</a></h3><p>Instead of exposing an explicit state, we can wrap it up inside an object with
(mutable) internal state. Here is a Java version of the vending machine, which also
replaces the discrete transition graph with a calculated transition function:</p><div class="codeBlockWrapper_cAds"><pre class="prism-code language-java codeBlock_6upA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class VendingMachine {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private int price;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  private int balance;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public VendingMachine(int price) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    this.price = price;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    this.balance = 0;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   * Insert the given amount of money; returns true if an item is vended.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public boolean deposit(int amount) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    balance += amount;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    if (balance &gt;= price) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      balance -= price;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return true;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    } else {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return false;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public static void main(String[] args) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    VendingMachine machine = new VendingMachine(25);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    String input = &quot;NNNNQDNND&quot;; // Should print Candy! three times</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    for (int i = 0; i &lt; input.length(); i++) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      boolean candy = false;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      switch (input.charAt(i)) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        case &#x27;N&#x27;: candy = machine.deposit(5); break;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        case &#x27;D&#x27;: candy = machine.deposit(10); break;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        case &#x27;Q&#x27;: candy = machine.deposit(25); break;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        default: throw new RuntimeException(&quot;Invalid input&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (candy) System.out.println(&quot;Candy!&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_2e3i">Copy</button></div><h2 class="anchor anchorWithStickyNavbar_31ik" id="exercises">Exercises<a aria-hidden="true" class="hash-link" href="#exercises" title="Direct link to heading">â€‹</a></h2><ol><li><p>Sketch the process of constructing a Mealy machine from a Moore machine, and <em>vice versa</em>.</p></li><li><p>Give at least two implementations of a state machine that recognizes valid floating-point literals in Java.
You will first need to research the Java language definition to learn what constitutes a valid literal.</p></li><li><p>Give at least two implementations of a state machine (expressed as either a Mealy or Moore machine) that
simulates the operation of a keypad-based lock. There should be ten input buttons, one for each decimal digit,
and two output signals, &quot;lock&quot; and &quot;unlock.&quot; If the code 1234 in sequence is ever entered on the keypad, then the unlock
signal should be produced. After any other key press (that is, if the last four digits entered at any point were
not 1234), the output should be &quot;lock&quot;.</p></li></ol></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/bhoward/focsipedia/edit/master/docs/fp/state.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/focsipedia/docs/fp/doodle"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->DPoodle Graphics</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/focsipedia/docs/fp/parser-comb"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Recursive Descent and Parser Combinators<!-- --> Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#strings-containing-aeiou" class="table-of-contents__link toc-highlight">Strings containing &quot;aeiou&quot;</a><ul><li><a href="#state-implicit-in-conditional-statements" class="table-of-contents__link toc-highlight">State implicit in conditional statements</a></li><li><a href="#integer-state-with-transitions-in-a-graph" class="table-of-contents__link toc-highlight">Integer state with transitions in a graph</a></li><li><a href="#object-oriented-state-and-transitions" class="table-of-contents__link toc-highlight">Object-oriented state and transitions</a></li><li><a href="#functional-state-and-transitions" class="table-of-contents__link toc-highlight">Functional state and transitions</a></li></ul></li><li><a href="#vending-machine" class="table-of-contents__link toc-highlight">Vending Machine</a><ul><li><a href="#integer-state-with-transitions-in-a-graph-1" class="table-of-contents__link toc-highlight">Integer state with transitions in a graph</a></li><li><a href="#object-oriented-approach-with-encapsulated-state" class="table-of-contents__link toc-highlight">Object-oriented approach with encapsulated state</a></li></ul></li><li><a href="#exercises" class="table-of-contents__link toc-highlight">Exercises</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/focsipedia/docs/policies">Policies</a></li><li class="footer__item"><a class="footer__link-item" href="/focsipedia/docs/styleGuide">Style Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/focsipedia/docs/attribution">Attribution</a></li></ul></div><div class="col footer__col"><div class="footer__title">Social</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/bhoward/focsipedia" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/BrnHwrd" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Brian T. Howard. Built with Docusaurus.</div></div></div></footer></div>
<script src="/focsipedia/assets/js/runtime~main.c33171f0.js"></script>
<script src="/focsipedia/assets/js/main.d0c66c92.js"></script>
</body>
</html>