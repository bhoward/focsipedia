

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>State Machines in Java and ReasonML &#8212; FoCSipedia</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Recursive Descent and Parser Combinators" href="parser-comb.html" />
    <link rel="prev" title="Spring 2020 DPoodle Gallery, Section B" href="galleryS20B.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/SmartFoxLogo.jpeg" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">FoCSipedia</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../attribution.html">
   Attribution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../topics.html">
   Topics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../overview.html">
   Overview of Topics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../logic/index.html">
   Logic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../sets/index.html">
   Sets
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="reference internal" href="index.html">
   Functional Programming
  </a>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="intro.html">
     Introduction to Functional Programming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="types.html">
     Types in Functional Programming
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="map-reduce.html">
     Map and Reduce on Lists
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="doodle.html">
     DPoodle Graphics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="doodle-project.html">
     DPoodle Graphics Drawing Project
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="scaladoodle.html">
     Scala Doodle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="galleryS20A.html">
     Spring 2020 DPoodle Gallery, Section A
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="galleryS20B.html">
     Spring 2020 DPoodle Gallery, Section B
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     State Machines in Java and ReasonML
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="parser-comb.html">
     Recursive Descent and Parser Combinators
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="lambda.html">
     Lambda Calculus
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ds/index.html">
   Data Structures
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../lang/index.html">
   Formal Languages
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/fp/state.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> On this page
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#strings-containing-aeiou">
   Strings containing “aeiou”
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#state-implicit-in-conditional-statements">
     State implicit in conditional statements
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#integer-state-with-transitions-in-a-graph">
     Integer state with transitions in a graph
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#object-oriented-state-and-transitions">
     Object-oriented state and transitions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functional-state-and-transitions">
     Functional state and transitions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#vending-machine">
   Vending Machine
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id1">
     Integer state with transitions in a graph
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#object-oriented-approach-with-encapsulated-state">
     Object-oriented approach with encapsulated state
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="state-machines-in-java-and-reasonml">
<h1>State Machines in Java and ReasonML<a class="headerlink" href="#state-machines-in-java-and-reasonml" title="Permalink to this headline">¶</a></h1>
<p>There are many ways to implement the state machine concept in code. The essence is that
the input is processed one item at a time, in order, with only a fixed amount of
information (the “state”) preserved from one item to the next. The iteration over the
items may be performed by a loop or recursion; the state may be maintained explicitly
in variables or hidden in an object, or it may be implicit in the current section of
code being executed; the transition from one state to the next may be controlled by a
series of conditional statements, a data structure representing the transition graph,
or a function which encapsulates the required logic. Here are some examples:</p>
<div class="section" id="strings-containing-aeiou">
<h2>Strings containing “aeiou”<a class="headerlink" href="#strings-containing-aeiou" title="Permalink to this headline">¶</a></h2>
<p>This is an example from Section 10.2 of <a class="reference external" href="http://infolab.stanford.edu/~ullman/focs.html">Aho &amp; Ullman</a>.
A string of lower-case letters will be accepted if it contains the vowels <em>a</em>, <em>e</em>, <em>i</em>, <em>o</em>, and <em>u</em>, in that order
(the vowels may occur in other positions as well, as in “sacrilegious”).</p>
<div class="section" id="state-implicit-in-conditional-statements">
<h3>State implicit in conditional statements<a class="headerlink" href="#state-implicit-in-conditional-statements" title="Permalink to this headline">¶</a></h3>
<p>Here to start is a Java version of Aho &amp; Ullman’s Figure 10.2 (the original was in C):</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ContainsAEIOU</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="n">String</span> <span class="n">word</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>

  <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">findChar</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">word</span><span class="p">.</span><span class="na">length</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">word</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">index</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">word</span><span class="p">.</span><span class="na">length</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// character c found at position index; prepare for next call</span>
      <span class="n">index</span><span class="o">++</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// character not found in rest of word</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">test</span><span class="p">(</span><span class="n">String</span> <span class="n">word</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">word</span> <span class="o">=</span> <span class="n">word</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="cm">/* state 0 */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">findChar</span><span class="p">(</span><span class="sc">&#39;a&#39;</span><span class="p">))</span>
      <span class="cm">/* state 1 */</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">findChar</span><span class="p">(</span><span class="sc">&#39;e&#39;</span><span class="p">))</span>
        <span class="cm">/* state 2 */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">findChar</span><span class="p">(</span><span class="sc">&#39;i&#39;</span><span class="p">))</span>
          <span class="cm">/* state 3 */</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">findChar</span><span class="p">(</span><span class="sc">&#39;o&#39;</span><span class="p">))</span>
            <span class="cm">/* state 4 */</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">findChar</span><span class="p">(</span><span class="sc">&#39;u&#39;</span><span class="p">))</span>
              <span class="cm">/* state 5 */</span>
              <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="cm">/* error state */</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">ContainsAEIOU</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContainsAEIOU</span><span class="p">();</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="s">&quot;abstemious&quot;</span><span class="p">));</span> <span class="c1">// should be true</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="s">&quot;sacrilegious&quot;</span><span class="p">));</span> <span class="c1">// should be true</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="s">&quot;undercoating&quot;</span><span class="p">));</span> <span class="c1">// should be false -- not in order</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="s">&quot;religious&quot;</span><span class="p">));</span> <span class="c1">// should be false -- no a</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="na">test</span><span class="p">(</span><span class="s">&quot;aeiou&quot;</span><span class="p">));</span> <span class="c1">// should be true</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The input is processed in this version by the <code class="docutils literal notranslate"><span class="pre">while</span></code> loop in the <code class="docutils literal notranslate"><span class="pre">findChar</span></code>
method; the variable <code class="docutils literal notranslate"><span class="pre">index</span></code> (which is a class instance variable so that its value
will persist between calls to <code class="docutils literal notranslate"><span class="pre">findChar</span></code>) is used to step through the characters in the word.
The current “state” is reflected in how far the execution has progressed through
the nested <code class="docutils literal notranslate"><span class="pre">if</span></code> statements in <code class="docutils literal notranslate"><span class="pre">test</span></code>; after reading characters for a while in
state 0, it transitions to state 1 when the first <em>a</em> is seen, then to state 2 upon
seeing a following <em>e</em>, <em>etc</em>. If any of the calls to <code class="docutils literal notranslate"><span class="pre">findChar</span></code> return false, meaning
the end of the string has been reached while looking for one of the vowels, then the
machine enters an error state (<em>i.e.</em>, it falls through to the <code class="docutils literal notranslate"><span class="pre">return</span> <span class="pre">false</span></code> at the end).
If all of the calls to <code class="docutils literal notranslate"><span class="pre">findChar</span></code> succeed, then the
machine reaches state 5 and immediately returns true (without looking at the rest
of the string).</p>
<p>Given the way the <code class="docutils literal notranslate"><span class="pre">&amp;&amp;</span></code> operator is evaluated from left to right, the sequence of <code class="docutils literal notranslate"><span class="pre">if</span></code> and
<code class="docutils literal notranslate"><span class="pre">return</span></code> statements in the <code class="docutils literal notranslate"><span class="pre">test</span></code> method could also be written</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">findChar</span><span class="p">(</span><span class="sc">&#39;a&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">findChar</span><span class="p">(</span><span class="sc">&#39;e&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">findChar</span><span class="p">(</span><span class="sc">&#39;i&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">findChar</span><span class="p">(</span><span class="sc">&#39;o&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">findChar</span><span class="p">(</span><span class="sc">&#39;u&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>This is completely equivalent (and likely even generates the same compiled code), although
it might be harder to see which point in the code corresponds to each state.</p>
<p>The Java version is a very imperative approach to the problem, depending as it does on changes
to the variable <code class="docutils literal notranslate"><span class="pre">index</span></code> as it traces through the sequence of method calls and loops. Here is a
more functional equivalent in ReasonML, where indexing into a string is replaced by traversing
through a list of characters, and the <code class="docutils literal notranslate"><span class="pre">findChar</span></code> method returns a pair of a boolean plus the
list of the remaining unsearched characters:</p>
<div class="highlight-reason notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">findChar</span> <span class="ow">=</span> <span class="ow">(</span><span class="n">chars</span><span class="ow">,</span> <span class="n">c</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">{</span>
  <span class="k">switch</span> <span class="ow">(</span><span class="n">chars</span><span class="ow">)</span> <span class="ow">{</span>
  <span class="ow">|</span> <span class="bp">[]</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="bp">false</span><span class="ow">,</span> <span class="bp">[]</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">[</span><span class="n">head</span><span class="ow">,</span> <span class="ow">...</span><span class="n">tail</span><span class="ow">]</span> <span class="ow">=&gt;</span> <span class="k">if</span> <span class="ow">(</span><span class="n">head</span> <span class="ow">==</span> <span class="n">c</span><span class="ow">)</span> <span class="ow">{</span>
      <span class="ow">(</span><span class="bp">true</span><span class="ow">,</span> <span class="n">tail</span><span class="ow">)</span>
    <span class="ow">}</span> <span class="k">else</span> <span class="ow">{</span>
      <span class="n">findChar</span><span class="ow">(</span><span class="n">tail</span><span class="ow">,</span> <span class="n">c</span><span class="ow">)</span>
    <span class="ow">}</span>
  <span class="ow">}</span>
<span class="ow">};</span>

<span class="k">let</span> <span class="n">test</span> <span class="ow">=</span> <span class="n">word</span> <span class="ow">=&gt;</span> <span class="ow">{</span>
  <span class="cm">/* expand a string to a list of characters */</span>
  <span class="k">let</span> <span class="n">chars</span> <span class="ow">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">init</span><span class="ow">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span><span class="ow">(</span><span class="n">word</span><span class="ow">),</span> <span class="nn">String</span><span class="p">.</span><span class="n">get</span><span class="ow">(</span><span class="n">word</span><span class="ow">));</span>
  <span class="cm">/* state 0 */</span>
  <span class="k">let</span> <span class="ow">(</span><span class="n">foundA</span><span class="ow">,</span> <span class="n">rest</span><span class="ow">)</span> <span class="ow">=</span> <span class="n">findChar</span><span class="ow">(</span><span class="n">chars</span><span class="ow">,</span> <span class="sc">&#39;a&#39;</span><span class="ow">);</span>
  <span class="k">if</span> <span class="ow">(</span><span class="n">foundA</span><span class="ow">)</span> <span class="ow">{</span>
    <span class="cm">/* state 1 */</span>
    <span class="k">let</span> <span class="ow">(</span><span class="n">foundE</span><span class="ow">,</span> <span class="n">rest</span><span class="ow">)</span> <span class="ow">=</span> <span class="n">findChar</span><span class="ow">(</span><span class="n">rest</span><span class="ow">,</span> <span class="sc">&#39;e&#39;</span><span class="ow">);</span>
    <span class="k">if</span> <span class="ow">(</span><span class="n">foundE</span><span class="ow">)</span> <span class="ow">{</span>
      <span class="cm">/* state 2 */</span>
      <span class="k">let</span> <span class="ow">(</span><span class="n">foundI</span><span class="ow">,</span> <span class="n">rest</span><span class="ow">)</span> <span class="ow">=</span> <span class="n">findChar</span><span class="ow">(</span><span class="n">rest</span><span class="ow">,</span> <span class="sc">&#39;i&#39;</span><span class="ow">);</span>
      <span class="k">if</span> <span class="ow">(</span><span class="n">foundI</span><span class="ow">)</span> <span class="ow">{</span>
        <span class="cm">/* state 3 */</span>
        <span class="k">let</span> <span class="ow">(</span><span class="n">foundO</span><span class="ow">,</span> <span class="n">rest</span><span class="ow">)</span> <span class="ow">=</span> <span class="n">findChar</span><span class="ow">(</span><span class="n">rest</span><span class="ow">,</span> <span class="sc">&#39;o&#39;</span><span class="ow">);</span>
        <span class="k">if</span> <span class="ow">(</span><span class="n">foundO</span><span class="ow">)</span> <span class="ow">{</span>
          <span class="cm">/* state 4 */</span>
          <span class="k">let</span> <span class="ow">(</span><span class="n">foundU</span><span class="ow">,</span> <span class="n">rest</span><span class="ow">)</span> <span class="ow">=</span> <span class="n">findChar</span><span class="ow">(</span><span class="n">rest</span><span class="ow">,</span> <span class="sc">&#39;u&#39;</span><span class="ow">);</span>
          <span class="k">if</span> <span class="ow">(</span><span class="n">foundU</span><span class="ow">)</span> <span class="ow">{</span>
            <span class="cm">/* state 5 */</span>
            <span class="bp">true</span>
          <span class="ow">}</span> <span class="k">else</span> <span class="bp">false</span>
        <span class="ow">}</span> <span class="k">else</span> <span class="bp">false</span>
      <span class="ow">}</span> <span class="k">else</span> <span class="bp">false</span>
    <span class="ow">}</span> <span class="k">else</span> <span class="bp">false</span>
  <span class="ow">}</span> <span class="k">else</span> <span class="bp">false</span>
<span class="ow">};</span>

<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;abstemious&quot;</span><span class="ow">);</span> <span class="cm">/* should be true */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;sacrilegious&quot;</span><span class="ow">);</span> <span class="cm">/* should be true */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;undercoating&quot;</span><span class="ow">);</span> <span class="cm">/* should be false -- not in order */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;religious&quot;</span><span class="ow">);</span> <span class="cm">/* should be false -- no a */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;aeiou&quot;</span><span class="ow">);</span> <span class="cm">/* should be true */</span>
</pre></div>
</div>
</div>
<div class="section" id="integer-state-with-transitions-in-a-graph">
<h3>Integer state with transitions in a graph<a class="headerlink" href="#integer-state-with-transitions-in-a-graph" title="Permalink to this headline">¶</a></h3>
<p>Here is the same state machine, with the state explicitly represented by an integer
in the range 0 to 5. The transitions are stored in an array of functions: <code class="docutils literal notranslate"><span class="pre">trans[i]</span></code> is the
function, for state <code class="docutils literal notranslate"><span class="pre">i</span></code>, from the current character to the next state.
Note that this is similar to the adjacency matrix representation of a graph, except here
we are looking up a node (<code class="docutils literal notranslate"><span class="pre">i</span></code>) and an input symbol (<code class="docutils literal notranslate"><span class="pre">c</span></code>) to select an adjacent node, instead
of looking up two nodes to see whether they are adjacent.
Each of the functions in
this case is particularly simple, since at most one edge leads away from each state
to another. See below for other examples using more complicated graphs.</p>
<div class="highlight-reason notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">trans</span> <span class="ow">=</span> <span class="ow">[|</span>
  <span class="ow">(</span><span class="n">c</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="k">if</span> <span class="ow">(</span><span class="n">c</span> <span class="ow">==</span> <span class="sc">&#39;a&#39;</span><span class="ow">)</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="ow">,</span> <span class="cm">/* state 0 */</span>
  <span class="ow">(</span><span class="n">c</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="k">if</span> <span class="ow">(</span><span class="n">c</span> <span class="ow">==</span> <span class="sc">&#39;e&#39;</span><span class="ow">)</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="ow">,</span> <span class="cm">/* state 1 */</span>
  <span class="ow">(</span><span class="n">c</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="k">if</span> <span class="ow">(</span><span class="n">c</span> <span class="ow">==</span> <span class="sc">&#39;i&#39;</span><span class="ow">)</span> <span class="mi">3</span> <span class="k">else</span> <span class="mi">2</span><span class="ow">,</span> <span class="cm">/* state 2 */</span>
  <span class="ow">(</span><span class="n">c</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="k">if</span> <span class="ow">(</span><span class="n">c</span> <span class="ow">==</span> <span class="sc">&#39;o&#39;</span><span class="ow">)</span> <span class="mi">4</span> <span class="k">else</span> <span class="mi">3</span><span class="ow">,</span> <span class="cm">/* state 3 */</span>
  <span class="ow">(</span><span class="n">c</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="k">if</span> <span class="ow">(</span><span class="n">c</span> <span class="ow">==</span> <span class="sc">&#39;u&#39;</span><span class="ow">)</span> <span class="mi">5</span> <span class="k">else</span> <span class="mi">4</span><span class="ow">,</span> <span class="cm">/* state 4 */</span>
  <span class="ow">(</span><span class="n">c</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="mi">5</span> <span class="cm">/* state 5 */</span>
<span class="ow">|];</span>

<span class="k">let</span> <span class="n">test</span> <span class="ow">=</span> <span class="n">word</span> <span class="ow">=&gt;</span> <span class="ow">{</span>
  <span class="k">let</span> <span class="n">chars</span> <span class="ow">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">init</span><span class="ow">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span><span class="ow">(</span><span class="n">word</span><span class="ow">),</span> <span class="nn">String</span><span class="p">.</span><span class="n">get</span><span class="ow">(</span><span class="n">word</span><span class="ow">));</span>
  <span class="cm">/* List.fold_left is our reduce function */</span>
	<span class="k">let</span> <span class="n">final_state</span> <span class="ow">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span><span class="ow">((</span><span class="n">state</span><span class="ow">,</span> <span class="n">c</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="n">trans</span><span class="ow">[</span><span class="n">state</span><span class="ow">](</span><span class="n">c</span><span class="ow">),</span> <span class="mi">0</span><span class="ow">,</span> <span class="n">chars</span><span class="ow">);</span>
  <span class="n">final_state</span> <span class="ow">==</span> <span class="mi">5</span> <span class="cm">/* returns true if accepting state reached */</span>
<span class="ow">}</span>

<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;abstemious&quot;</span><span class="ow">);</span> <span class="cm">/* should be true */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;sacrilegious&quot;</span><span class="ow">);</span> <span class="cm">/* should be true */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;undercoating&quot;</span><span class="ow">);</span> <span class="cm">/* should be false -- not in order */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;religious&quot;</span><span class="ow">);</span> <span class="cm">/* should be false -- no a */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;aeiou&quot;</span><span class="ow">);</span> <span class="cm">/* should be true */</span>
</pre></div>
</div>
<p>Walking over a list and applying a transition function from the current state and input
item to get the next state is just a direct application of our <code class="docutils literal notranslate"><span class="pre">reduce</span></code> function on
lists; the ReasonML library calls it <code class="docutils literal notranslate"><span class="pre">List.fold_left</span></code>.</p>
</div>
<div class="section" id="object-oriented-state-and-transitions">
<h3>Object-oriented state and transitions<a class="headerlink" href="#object-oriented-state-and-transitions" title="Permalink to this headline">¶</a></h3>
<p>Instead of assigning arbitrary numbers to the states, and collecting all of the
transition information into a global graph data structure, a more object-oriented
approach associates an object with each state. Here is a Java implementation of this idea:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">package</span> <span class="nn">edu.depauw.csc233</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ContainsAEIOU2</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kd">interface</span> <span class="nc">State</span> <span class="p">{</span>
    <span class="n">State</span> <span class="nf">trans</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">);</span>
    <span class="k">default</span> <span class="kt">boolean</span> <span class="nf">accept</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">InitialState</span> <span class="kd">implements</span> <span class="n">State</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">State</span> <span class="nf">trans</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;a&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">AState</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AState</span> <span class="kd">implements</span> <span class="n">State</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">State</span> <span class="nf">trans</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;e&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">AEState</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AEState</span> <span class="kd">implements</span> <span class="n">State</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">State</span> <span class="nf">trans</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;i&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">AEIState</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AEIState</span> <span class="kd">implements</span> <span class="n">State</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">State</span> <span class="nf">trans</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;o&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">AEIOState</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AEIOState</span> <span class="kd">implements</span> <span class="n">State</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">State</span> <span class="nf">trans</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;u&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">AEIOUState</span><span class="p">();</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">AEIOUState</span> <span class="kd">implements</span> <span class="n">State</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="n">State</span> <span class="nf">trans</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">accept</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">test</span><span class="p">(</span><span class="n">String</span> <span class="n">word</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">State</span> <span class="n">state</span> <span class="o">=</span> <span class="k">new</span> <span class="n">InitialState</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">word</span><span class="p">.</span><span class="na">length</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">state</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="na">trans</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">state</span><span class="p">.</span><span class="na">accept</span><span class="p">();</span>
  <span class="p">}</span>
  
  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">test</span><span class="p">(</span><span class="s">&quot;abstemious&quot;</span><span class="p">));</span> <span class="c1">// should be true</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">test</span><span class="p">(</span><span class="s">&quot;sacrilegious&quot;</span><span class="p">));</span> <span class="c1">// should be true</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">test</span><span class="p">(</span><span class="s">&quot;undercoating&quot;</span><span class="p">));</span> <span class="c1">// should be false -- not in order</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">test</span><span class="p">(</span><span class="s">&quot;religious&quot;</span><span class="p">));</span> <span class="c1">// should be false -- no a</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">test</span><span class="p">(</span><span class="s">&quot;aeiou&quot;</span><span class="p">));</span> <span class="c1">// should be true</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Each of the state classes implements the <code class="docutils literal notranslate"><span class="pre">State</span></code> interface, which bundles both a
transition method, <code class="docutils literal notranslate"><span class="pre">trans</span></code> (it computes the next state for a given input character),
and an <code class="docutils literal notranslate"><span class="pre">accept</span></code> method (it returns true if the state is accepting; the interface
provides a default implementation that returns false). The <code class="docutils literal notranslate"><span class="pre">test</span></code> function now only
needs to know the initial state; it would be written in exactly the same way for
any machine that processes the characters in a string.</p>
</div>
<div class="section" id="functional-state-and-transitions">
<h3>Functional state and transitions<a class="headerlink" href="#functional-state-and-transitions" title="Permalink to this headline">¶</a></h3>
<p>An interesting functional equivalent to the previous object-oriented version
represents each state by a pair of a boolean and a function from characters to states.
Since the <code class="docutils literal notranslate"><span class="pre">state</span></code> type is defined in terms of itself, we need to wrap it up in a
constructor:</p>
<div class="highlight-reason notranslate"><div class="highlight"><pre><span></span><span class="k">type</span> <span class="n">state</span> <span class="ow">=</span> <span class="nc">State</span><span class="ow">(</span><span class="kt">bool</span><span class="ow">,</span> <span class="kt">char</span> <span class="ow">=&gt;</span> <span class="n">state</span><span class="ow">);</span>
</pre></div>
</div>
<p>Here is the code for our “aeiou” machine:</p>
<div class="highlight-reason notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="k">rec</span> <span class="n">initialState</span> <span class="ow">=</span> <span class="nc">State</span><span class="ow">(</span><span class="bp">false</span><span class="ow">,</span> <span class="n">c</span> <span class="ow">=&gt;</span> <span class="k">if</span> <span class="ow">(</span><span class="n">c</span> <span class="ow">==</span> <span class="sc">&#39;a&#39;</span><span class="ow">)</span> <span class="n">aState</span> <span class="k">else</span> <span class="n">initialState</span><span class="ow">)</span>
<span class="ow">and</span> <span class="n">aState</span> <span class="ow">=</span> <span class="nc">State</span><span class="ow">(</span><span class="bp">false</span><span class="ow">,</span> <span class="n">c</span> <span class="ow">=&gt;</span> <span class="k">if</span> <span class="ow">(</span><span class="n">c</span> <span class="ow">==</span> <span class="sc">&#39;e&#39;</span><span class="ow">)</span> <span class="n">aeState</span> <span class="k">else</span> <span class="n">aState</span><span class="ow">)</span>
<span class="ow">and</span> <span class="n">aeState</span> <span class="ow">=</span> <span class="nc">State</span><span class="ow">(</span><span class="bp">false</span><span class="ow">,</span> <span class="n">c</span> <span class="ow">=&gt;</span> <span class="k">if</span> <span class="ow">(</span><span class="n">c</span> <span class="ow">==</span> <span class="sc">&#39;i&#39;</span><span class="ow">)</span> <span class="n">aeiState</span> <span class="k">else</span> <span class="n">aeState</span><span class="ow">)</span>
<span class="ow">and</span> <span class="n">aeiState</span> <span class="ow">=</span> <span class="nc">State</span><span class="ow">(</span><span class="bp">false</span><span class="ow">,</span> <span class="n">c</span> <span class="ow">=&gt;</span> <span class="k">if</span> <span class="ow">(</span><span class="n">c</span> <span class="ow">==</span> <span class="sc">&#39;o&#39;</span><span class="ow">)</span> <span class="n">aeioState</span> <span class="k">else</span> <span class="n">aeiState</span><span class="ow">)</span>
<span class="ow">and</span> <span class="n">aeioState</span> <span class="ow">=</span> <span class="nc">State</span><span class="ow">(</span><span class="bp">false</span><span class="ow">,</span> <span class="n">c</span> <span class="ow">=&gt;</span> <span class="k">if</span> <span class="ow">(</span><span class="n">c</span> <span class="ow">==</span> <span class="sc">&#39;u&#39;</span><span class="ow">)</span> <span class="n">aeiouState</span> <span class="k">else</span> <span class="n">aeioState</span><span class="ow">)</span>
<span class="ow">and</span> <span class="n">aeiouState</span> <span class="ow">=</span> <span class="nc">State</span><span class="ow">(</span><span class="bp">true</span><span class="ow">,</span> <span class="ow">_</span> <span class="ow">=&gt;</span> <span class="n">aeiouState</span><span class="ow">);</span>

<span class="k">let</span> <span class="n">test</span> <span class="ow">=</span> <span class="n">word</span> <span class="ow">=&gt;</span> <span class="ow">{</span>
  <span class="k">let</span> <span class="n">chars</span> <span class="ow">=</span> <span class="nn">List</span><span class="p">.</span><span class="n">init</span><span class="ow">(</span><span class="nn">String</span><span class="p">.</span><span class="n">length</span><span class="ow">(</span><span class="n">word</span><span class="ow">),</span> <span class="nn">String</span><span class="p">.</span><span class="n">get</span><span class="ow">(</span><span class="n">word</span><span class="ow">));</span>
  <span class="k">let</span> <span class="nc">State</span><span class="ow">(</span><span class="n">accept</span><span class="ow">,</span> <span class="ow">_)</span> <span class="ow">=</span>
    <span class="nn">List</span><span class="p">.</span><span class="n">fold_left</span><span class="ow">((</span><span class="nc">State</span><span class="ow">(_,</span> <span class="n">trans</span><span class="ow">),</span> <span class="n">c</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="n">trans</span><span class="ow">(</span><span class="n">c</span><span class="ow">),</span> <span class="n">initialState</span><span class="ow">,</span> <span class="n">chars</span><span class="ow">);</span>
  <span class="n">accept</span>
<span class="ow">};</span>

<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;abstemious&quot;</span><span class="ow">);</span> <span class="cm">/* should be true */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;sacrilegious&quot;</span><span class="ow">);</span> <span class="cm">/* should be true */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;undercoating&quot;</span><span class="ow">);</span> <span class="cm">/* should be false -- not in order */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;religious&quot;</span><span class="ow">);</span> <span class="cm">/* should be false -- no a */</span>
<span class="n">test</span><span class="ow">(</span><span class="s2">&quot;aeiou&quot;</span><span class="ow">);</span> <span class="cm">/* should be true */</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="vending-machine">
<h2>Vending Machine<a class="headerlink" href="#vending-machine" title="Permalink to this headline">¶</a></h2>
<p>Suppose we want to model a vending machine which accepts nickels, dimes, and quarters,
and dispenses a piece of candy when 25 cents has been deposited. If more than 25 cents
is put in (for example, three dimes), then after dispensing the candy the remaining
amount is applied toward the next transaction (that is, it doesn’t give any change).</p>
<p>This use of a finite state machine is a bit different from what we have seen before, since
there is no notion of an “accepting” state. Instead, we imagine that the machine is
performing a long-running computation (in this case, it runs as long as the vending
machine is in service, potentially for years).
It is customary for this kind of machine to add a notion of “output,” so that the
machine can give feedback after each transition instead of just at the end (which may
never come). There are two standard models for doing this:</p>
<ul class="simple">
<li><p>A <strong>Mealy Machine</strong> is a finite state machine where each transition has an associated
output. We annotate each transition with a label such as <span class="math notranslate nohighlight">\(a/x\)</span>, meaning that it takes the
transition if the input is <span class="math notranslate nohighlight">\(a\)</span>, and as it does so it produces output <span class="math notranslate nohighlight">\(x\)</span>.</p></li>
<li><p>A <strong>Moore Machine</strong> is a finite state machine where the output after each transition is
determined by the new state. Each state has a label such as <span class="math notranslate nohighlight">\(A/x\)</span>, meaning that when the
machine transitions to state <span class="math notranslate nohighlight">\(A\)</span> it will also produce output <span class="math notranslate nohighlight">\(x\)</span>.</p></li>
</ul>
<p>For both kinds of machines, the output may be <span class="math notranslate nohighlight">\(\varepsilon\)</span> if no output is desired at that time.
It is not very difficult to see that Mealy and Moore machines have equivalent power, by showing
how to construct each from the other; the choice is often a matter of convenience. For example,
in constructing a sequential circuit implementation, the Moore machine has the advantage that
the output part of the circuit only needs lines connecting to the current state (the outputs
of the flip-flops), while the Mealy machine may require fewer states (and hence fewer flip-flops)
in some cases.</p>
<div class="section" id="id1">
<h3>Integer state with transitions in a graph<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>We will adopt a similar solution as for the second version of the vowel problem. This
time, the integer state numbers will be more meaningful: they will be 0, 5, 10, 15,
and 20, representing the amount of money which has been deposited so far. Since these
are not consecutive, the graph will be represented by a function with two inputs instead of an
array of functions. Also, there will be no need for default transitions, since each of the
three possible inputs (‘N’, ‘D’, or ‘Q’, for nickel, dime, and quarter) will cause a
different change of state. One further difference is that each edge in the graph will
give not only a new state but also an indication of whether candy was given out on
the transition (this means that it is a Mealy machine). Finally, there is no accepting state, since the machine will keep
running as long as there is input; in the example below, we will print “Candy!”
whenever it produces a piece of candy.</p>
<div class="highlight-reason notranslate"><div class="highlight"><pre><span></span><span class="k">let</span> <span class="n">vtrans</span> <span class="ow">=</span> <span class="ow">(</span><span class="n">amount</span><span class="ow">,</span> <span class="n">input</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">{</span>
  <span class="k">switch</span> <span class="ow">(</span><span class="n">amount</span><span class="ow">,</span> <span class="n">input</span><span class="ow">)</span> <span class="ow">{</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">0</span><span class="ow">,</span> <span class="sc">&#39;N&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">5</span><span class="ow">,</span> <span class="bp">false</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">0</span><span class="ow">,</span> <span class="sc">&#39;D&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">10</span><span class="ow">,</span> <span class="bp">false</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">0</span><span class="ow">,</span> <span class="sc">&#39;Q&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">0</span><span class="ow">,</span> <span class="bp">true</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">5</span><span class="ow">,</span> <span class="sc">&#39;N&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">10</span><span class="ow">,</span> <span class="bp">false</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">5</span><span class="ow">,</span> <span class="sc">&#39;D&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">15</span><span class="ow">,</span> <span class="bp">false</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">5</span><span class="ow">,</span> <span class="sc">&#39;Q&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">5</span><span class="ow">,</span> <span class="bp">true</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">10</span><span class="ow">,</span> <span class="sc">&#39;N&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">15</span><span class="ow">,</span> <span class="bp">false</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">10</span><span class="ow">,</span> <span class="sc">&#39;D&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">20</span><span class="ow">,</span> <span class="bp">false</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">10</span><span class="ow">,</span> <span class="sc">&#39;Q&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">10</span><span class="ow">,</span> <span class="bp">true</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">15</span><span class="ow">,</span> <span class="sc">&#39;N&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">20</span><span class="ow">,</span> <span class="bp">false</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">15</span><span class="ow">,</span> <span class="sc">&#39;D&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">0</span><span class="ow">,</span> <span class="bp">true</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">15</span><span class="ow">,</span> <span class="sc">&#39;Q&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">15</span><span class="ow">,</span> <span class="bp">true</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">20</span><span class="ow">,</span> <span class="sc">&#39;N&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">0</span><span class="ow">,</span> <span class="bp">true</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">20</span><span class="ow">,</span> <span class="sc">&#39;D&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">5</span><span class="ow">,</span> <span class="bp">true</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">(</span><span class="mi">20</span><span class="ow">,</span> <span class="sc">&#39;Q&#39;</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span><span class="mi">20</span><span class="ow">,</span> <span class="bp">true</span><span class="ow">)</span>
  <span class="ow">|</span> <span class="ow">_</span> <span class="ow">=&gt;</span> <span class="n">failwith</span><span class="ow">(</span><span class="s2">&quot;Invalid state or input&quot;</span><span class="ow">)</span>
  <span class="ow">}</span>
<span class="ow">}</span>

<span class="k">let</span> <span class="n">vend</span> <span class="ow">=</span> <span class="n">coins</span> <span class="ow">=&gt;</span> <span class="ow">{</span>
  <span class="k">let</span> <span class="k">rec</span> <span class="n">aux</span> <span class="ow">=</span> <span class="ow">(</span><span class="n">coins</span><span class="ow">,</span> <span class="n">state</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">{</span>
    <span class="k">switch</span> <span class="ow">(</span><span class="n">coins</span><span class="ow">)</span> <span class="ow">{</span>
    <span class="ow">|</span> <span class="bp">[]</span> <span class="ow">=&gt;</span> <span class="n">state</span>
    <span class="ow">|</span> <span class="ow">[</span><span class="n">head</span><span class="ow">,</span> <span class="ow">...</span><span class="n">tail</span><span class="ow">]</span> <span class="ow">=&gt;</span> <span class="ow">{</span>
        <span class="k">let</span> <span class="ow">(</span><span class="n">state&#39;</span><span class="ow">,</span> <span class="n">candy</span><span class="ow">)</span> <span class="ow">=</span> <span class="n">vtrans</span><span class="ow">(</span><span class="n">state</span><span class="ow">,</span> <span class="n">head</span><span class="ow">);</span>
        <span class="k">if</span> <span class="ow">(</span><span class="n">candy</span><span class="ow">)</span> <span class="n">print_string</span><span class="ow">(</span><span class="s2">&quot;Candy! &quot;</span><span class="ow">);</span>
        <span class="n">aux</span><span class="ow">(</span><span class="n">tail</span><span class="ow">,</span> <span class="n">state&#39;</span><span class="ow">)</span>
      <span class="ow">}</span>
    <span class="ow">}</span>
  <span class="ow">};</span>
  <span class="n">aux</span><span class="ow">(</span><span class="n">coins</span><span class="ow">,</span> <span class="mi">0</span><span class="ow">)</span>
<span class="ow">};</span>

<span class="n">vend</span><span class="ow">([</span><span class="sc">&#39;N&#39;</span><span class="ow">,</span> <span class="sc">&#39;N&#39;</span><span class="ow">,</span> <span class="sc">&#39;N&#39;</span><span class="ow">,</span> <span class="sc">&#39;N&#39;</span><span class="ow">,</span> <span class="sc">&#39;Q&#39;</span><span class="ow">,</span> <span class="sc">&#39;D&#39;</span><span class="ow">,</span> <span class="sc">&#39;N&#39;</span><span class="ow">,</span> <span class="sc">&#39;N&#39;</span><span class="ow">,</span> <span class="sc">&#39;D&#39;</span><span class="ow">]);</span> <span class="cm">/* Should print Candy! three times */</span>
</pre></div>
</div>
</div>
<div class="section" id="object-oriented-approach-with-encapsulated-state">
<h3>Object-oriented approach with encapsulated state<a class="headerlink" href="#object-oriented-approach-with-encapsulated-state" title="Permalink to this headline">¶</a></h3>
<p>Instead of exposing an explicit state, we can wrap it up inside an object with
(mutable) internal state. Here is a Java version of the vending machine, which also
replaces the discrete transition graph with a calculated transition function:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">VendingMachine</span> <span class="p">{</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">price</span><span class="p">;</span>
  <span class="kd">private</span> <span class="kt">int</span> <span class="n">balance</span><span class="p">;</span>
  
  <span class="kd">public</span> <span class="nf">VendingMachine</span><span class="p">(</span><span class="kt">int</span> <span class="n">price</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="na">price</span> <span class="o">=</span> <span class="n">price</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="na">balance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="cm">/**</span>
<span class="cm">   * Insert the given amount of money; returns true if an item is vended.</span>
<span class="cm">   */</span>
  <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">deposit</span><span class="p">(</span><span class="kt">int</span> <span class="n">amount</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">balance</span> <span class="o">+=</span> <span class="n">amount</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">balance</span> <span class="o">&gt;=</span> <span class="n">price</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">balance</span> <span class="o">-=</span> <span class="n">price</span><span class="p">;</span>
      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">VendingMachine</span> <span class="n">machine</span> <span class="o">=</span> <span class="k">new</span> <span class="n">VendingMachine</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span>
    <span class="n">String</span> <span class="n">input</span> <span class="o">=</span> <span class="s">&quot;NNNNQDNND&quot;</span><span class="p">;</span> <span class="c1">// Should print Candy! three times</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">input</span><span class="p">.</span><span class="na">length</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="kt">boolean</span> <span class="n">candy</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="k">switch</span> <span class="p">(</span><span class="n">input</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">case</span> <span class="sc">&#39;N&#39;</span><span class="p">:</span> <span class="n">candy</span> <span class="o">=</span> <span class="n">machine</span><span class="p">.</span><span class="na">deposit</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">&#39;D&#39;</span><span class="p">:</span> <span class="n">candy</span> <span class="o">=</span> <span class="n">machine</span><span class="p">.</span><span class="na">deposit</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="sc">&#39;Q&#39;</span><span class="p">:</span> <span class="n">candy</span> <span class="o">=</span> <span class="n">machine</span><span class="p">.</span><span class="na">deposit</span><span class="p">(</span><span class="mi">25</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="p">:</span> <span class="k">throw</span> <span class="k">new</span> <span class="n">RuntimeException</span><span class="p">(</span><span class="s">&quot;Invalid input&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">candy</span><span class="p">)</span> <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&quot;Candy!&quot;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="exercises">
<h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">¶</a></h2>
<ol class="simple">
<li><p>Sketch the process of constructing a Mealy machine from a Moore machine, and <em>vice versa</em>.</p></li>
<li><p>Give at least two implementations of a state machine that recognizes valid floating-point literals in Java.
You will first need to research the Java language definition to learn what constitutes a valid literal.</p></li>
<li><p>Give at least two implementations of a state machine (expressed as either a Mealy or Moore machine) that
simulates the operation of a keypad-based lock. There should be ten input buttons, one for each decimal digit,
and two output signals, “lock” and “unlock.” If the code 1234 in sequence is ever entered on the keypad, then the unlock
signal should be produced. After any other key press (that is, if the last four digits entered at any point were
not 1234), the output should be “lock”.</p></li>
</ol>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./fp"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="galleryS20B.html" title="previous page">Spring 2020 DPoodle Gallery, Section B</a>
    <a class='right-next' id="next-link" href="parser-comb.html" title="next page">Recursive Descent and Parser Combinators</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Brian T. Howard, based in part on material by Carol Critchlow and David Eck<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>